@page
@using Dolphin.Freight.Localization
@using Dolphin.Freight.Web.Pages.Components
@using Microsoft.Extensions.Localization
@using Dolphin.Freight.AirExports
@model Dolphin.Freight.Web.Pages.Accounting.InvoiceModel
@inject IStringLocalizer<FreightResource> L
@section scripts
    {
    <script type="text/javascript">
        var BillCodeItems = [];
        var PPOrCCItems = [];
        var BillTypeItems = [];
        var UnitItems = [];
        var CurrencyItems = [];
        var InvoiceBills = [];

        var currencyCodeToName = {
            INR: "INR",
            USD: "USD",
            RMB: "RMB",
            HKD: "HKD",
            TWD: "TWD"
        }

        const currencies = ['TWD', 'USD', 'RMB', 'HKD'];

        $(document).ready(function () {
            //initializeDropdownSearch('InvoiceDto_IncotermsId');

            dolphin.freight.common.ajaxDropdown.getSysCodeDtosByType({ queryType: 'PPOrCC' }).done(function (result) {
                if (result != null && result.length > 0) {
                    PPOrCCItems = result;
                }
            });
            dolphin.freight.common.ajaxDropdown.getSysCodeDtosByType({ queryType: 'BillType' }).done(function (result) {
                if (result != null && result.length > 0) {
                    BillTypeItems = result;
                }
            });
            dolphin.freight.common.ajaxDropdown.getSysCodeDtosByType({ queryType: 'Unit' }).done(function (result) {
                if (result != null && result.length > 0) {
                    UnitItems = result;
                }
            });
            dolphin.freight.settings.currencySetting.currencySetting.getList({}).done(function(result){
                CurrencyItems = result.items.map(m => m.startingCurrency);
            });
            //dolphin.freight.common.ajaxDropdown.getSysCodeDtosByType({ queryType: 'IncotermsId' }).done(function (result) {
            //    if (result != null && result.length > 0) {
            //        initSysCodeTag(result, "IncotermsId", $("#mIncotermsId").val())
            //    }
            //});

            //dolphin.freight.common.ajaxDropdown.getAllTradePartners({}).done(function (result) {
            //    var selectItems = result;
            //    initTradePartnerSelect(selectItems, "InvoiceCompanyId", $("#mInvoiceCompanyId").val());
            //    initTradePartnerSelect(selectItems, "ShipToId", $("#mShipToId").val());
            //});

            dolphin.freight.accountingSettings.billingCodes.billingCode.queryListForTag({
                IsUsed: true, BillType: @Model.InvoiceType, MethodType: @Model.MethodType
                                        }).done(function (result) {
                    BillCodeItems = result;
                    getInvoiceBills();
                });

            $("#addBtn").click(function () {
                addItems();
            });
            $("#add5Btn").click(function () {
                for (var i = 0; i < 5; i++) {
                    addItems();
                }
            });
            var formControl = 0;
            $("#saveBtn").click(function () {
                formControl = 0;
                $("#createForm").submit();
            });
            $("#saveDraftBtn").click(function () {
                formControl = 1;
                $("#InvoiceDto_InvoiceStatus").val(2);
                $("#createForm").submit();
            });
            $("#saveNewBtn").click(function () {
                formControl = 2;
                $("#createForm").submit();
            });
            $("#checkAll").click(function () {
                var checked = $(this).prop("checked");
                $(".checkItem").each(function () {
                    $(this).prop("checked", checked);
                })
            })
            $("#deleteBtn").click(function () {
                $(".checkItem").each(function () {
                    if ($(this).prop("checked")) {
                        let parent = $(this).parent().parent();
                        let id = parent.attr('id');
                        let index = id.substr(id.lastIndexOf('_') + 1);
                        let invoiceBillId = parent.find('[name="InvoiceBillDtos[' + index + '].Id"]').attr('value')

                        if (invoiceBillId) {
                            dolphin.freight.accounting.invoiceBills.invoiceBill.delete(invoiceBillId).done(function (result) {
                                parent.remove();
                            });
                        }
                        else {
                            parent.remove();
                        }

                    }
                })
            })
            $("#copyBtn").click(function () {
                $(".checkItem").each(function () {
                    if ($(this).prop("checked")) {
                        var id = $(this).data('val');
                        copyItems(id);
                    }
                })
            })
            $('#createForm').on('abp-ajax-success', function (result) {
                event.preventDefault();

                switch (formControl) {
                    case 0:
                        if (@Model.MethodType == 0) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/OceanImports/EditModal3?Id=@Model.Mid'; });
                        if (@Model.MethodType == 1) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/OceanExports/EditModal3?Id=@Model.Mid'; });
                        if (@Model.MethodType == 2) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/AirImports/EditModal3?Id=@Model.MawbId'; });
                        if (@Model.MethodType == 3) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/AirExports/EditModal3?Id=@Model.MawbId'; });
                        if (@Model.MethodType == 4) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/OceanExports/ExportBookings/Edit2?Id=@Model.Bid'; });
                          if (@Model.MethodType == 5) abp.message.success('儲存成功', '系統訊息').then(function(){ location.href = '/OceanExports/VesselSchedules/Edit2?Id=@Model.VesselId'; });
                        // if (@Model.MethodType == 5) $.ajax({
                        //                                 url: '/api/ImportExport/OceanExportAccountingHbl',
                        //                                 type: 'GET',
                        //                                 data: { Id: '@Model.Hid' },
                        //                                 success: function(response) {
                        //                                     abp.message.success('儲存成功', '系統訊息').then(function(){
                        //                                         dolphin.freight.importExport.oceanExports.oceanExportHbl.get('@Model.Hid').done(function (res) { 
                        //                                             location.href = '/OceanExports/EditModal3?Id='+res.mblId+'';
                        //                                         });
                        //                                     });
                        //                                 }
                        //                             });
                        if (@Model.MethodType == 6) $.ajax({
                                                        url: '/api/ImportExport/AirImportAccountHawb',
                                                        type: 'GET',
                                                        data: { Id: '@Model.HawbId' },
                                                        success: function(res) {
                                                            abp.message.success('儲存成功', '系統訊息').then(function(){
                                                                dolphin.freight.importExport.airImports.airImportHawb.get('@Model.HawbId')
                                                                .done(function(res){
                                                                    location.href = '/AirImports/EditModal3?Id=' + res.mawbId + '';
                                                                });
                                                            });
                                                        }
                                                    });
                        break;
                    case 1:
                        abp.message.success('以草稿儲存成功', '系統訊息');
                        if (@Model.MethodType == 0) location.href = '/OceanImports/EditModal3?Id=@Model.Mid';
                        if (@Model.MethodType == 1) location.href = '/OceanExports/EditModal3?Id=@Model.Mid';
                        if (@Model.MethodType == 2) location.href = '/AirImports/EditModal3?Id=@Model.MawbId';
                        if (@Model.MethodType == 3) location.href = '/AirExports/EditModal3?Id=@Model.MawbId';
                        if (@Model.MethodType == 4) location.href = '/OceanExports/ExportBookings/Edit2?Id=@Model.Bid';
                          if (@Model.MethodType == 5) location.href = '/OceanExports/VesselSchedules/Edit2?Id=@Model.VesselId';
                        break;
                    case 2:
                        abp.message.success('儲存成功', '系統訊息');
                        location.reload();
                        break;
                }


            });
        });

        function onQuantityChange(e) {
            let target = e.currentTarget || e.srcElement || e.target;
            var index = target.id.split('_')[1];
            let quantity = parseFloat($(target).val() || 0);
            let rate = parseFloat($(target).parent().next().children().val() || 0);
            $(target).parent().next().next().children().text(parseFloat(quantity * rate).toFixed(2));
            setCurrencyRate1($('#Currency_'+index+'').val(), event);
            getTotalSubAmount();
            getTotalAmount();
        }



        function onRateChange(e) {
            
            let target = e.currentTarget || e.srcElement || e.target;
            let rate = parseInt($(target).val() || 0);
            let quantity = parseInt($(target).parent().prev().children().val() || 0);
            $(target).parent().next().children().text(quantity * rate);
        }

        let currencyConvertor = '@Model.CurrencyConversionJson'.replaceAll('&quot;', '"');

        function onCurrencyChange(e) {
            let target = e.currentTarget || e.srcElement || e.target;
            var index = target.id.split('_')[1];

            var url = window.location.href;
            var urlParams = new URLSearchParams(new URL(url).search);

            let val = currencyCodeToName[$(target).val()];
            let conversion = JSON.parse(currencyConvertor);
            let rate = conversion["" + val + "-TWD"] || 1;
            if(val == undefined)
            {
                $('#Rate_'+ index).val(0);
                $('#Quantity_'+ index).val(0);
            }
            else{
                $('#Rate_'+ index).val(parseFloat(rate).toFixed(2));
            }

            setCurrencyRate1($(target).val(), event);

            var quantity = $('#Quantity_'+index).val();

            $('#Amount_'+index).text(parseFloat(quantity * rate).toFixed(2));
            if(document.getElementById('Amount_'+index+'').innerHTML == 'NaN'){
                document.getElementById('Amount_'+index+'').innerHTML = 0;
            }
            getTotalSubAmount();
            getTotalAmount();
        }


        function setCurrencyRate1(value, e) {
            let target = e.currentTarget || e.srcElement || e.target;
            var index = target.id.split('_')[1];
            let val = currencyCodeToName[value];
            let conversion = JSON.parse(currencyConvertor);
            let rate = conversion["" + val + "-TWD"];
            
            let quantity = $('#Quantity_'+ index +'').val();
            if($('#Currency_0').val() == 0){
                amount = 0;
            }
            currencies.forEach(function (currency) {
                let key = '' + val + '-' + currency + '';
                let convertedRate = conversion[key] || 1;

                document.getElementById("converted" + currency).innerHTML = (convertedRate * quantity).toFixed(2);
            })
        }

        function setCurrencyRate(value) {
            let val = currencyCodeToName[value];
            let conversion = JSON.parse(currencyConvertor);
            let rate = conversion["" + val + "-TWD"];
            
            let amount = $('#Quantity_'+index+'').val();
            if($('#Currency_0').val() == 0){
                amount = 0;
            }
            currencies.forEach(function (currency) {
                let key = '' + val + '-' + currency + '';
                let convertedRate = conversion[key] || 1;

                document.getElementById("converted" + currency).innerHTML = parseFloat(convertedRate * amount).toFixed(2);
            })
        }

        function getInvoiceBills() {
            dolphin.freight.accounting.invoiceBills.invoiceBill.queryInvoiceBills({
                InvoiceNo: '@Model.InvoiceId'
            }).done(function (result) {
                InvoiceBills = result;
                result.forEach(function (bill) {
                    addItems(bill); 
                })
            });
        }

        function getTotalAmount(){
            var table = $('#trtbody');
            var total = 0;

            for (var i = 0; i < table[0].rows.length; i++) {
              var amountCell = document.getElementById("Amount_" + i);
              
              var amount = parseFloat(amountCell.innerHTML);
              
              total += amount;
            }
            var totalAmountElement = document.getElementById("totalAmount");
            totalAmountElement.innerHTML = total.toFixed(2);
        }


        function getTotalSubAmount(){
            var table = $('#trtbody');
            var total = 0;

            for (var i = 0; i < table[0].rows.length; i++) {
              var amountCell = document.getElementById("Amount_" + i);
              
              var amount = parseFloat(amountCell.innerHTML);
              
              total += amount;
            }
            var totalAmountElement = document.getElementById("convertedTWD");
            totalAmountElement.innerHTML = total.toFixed(2);
            let conversion = JSON.parse(currencyConvertor);
            currencies.forEach(function (currency) {
                let key = 'TWD-' + currency + '';
                let convertedRate = conversion[key] || 1;

                document.getElementById("converted" + currency).innerHTML = (convertedRate * total).toFixed(2);
            })
        }

        var index = 0;
        function addItems(bill) {
            bill = bill || {};
            
            var url = window.location.href;
            var urlParams = new URLSearchParams(new URL(url).search);
            var id = urlParams.get("Mid");
            var amount = '';
            var trhtml = "<tr id='_" + index + "'><td style='text-align:center'><input class='checkItem' value='" + (bill.id || '') + "' type = 'checkbox' name = 'InvoiceBillDtos[" + index + "].BillId' id = 'InvoiceBillDtosId_" + index + "' data-val= 'new_" + index + "' /> </td>";
            trhtml = trhtml + "<td>" + getBillCodeSelect(index, '', (bill.code || '')) + "</td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].Description' value='" + (bill.description || '') + "' id='Description_" + index + "' /></td>";
            trhtml = trhtml + "<td>" + getPPOrCCSelect(index, '', (bill.ppOrCC || '')) + "</td>";
            trhtml = trhtml + "<td>" + getBillTypeSelect(index, '', (bill.billType || '')) + "</td>";
            trhtml = trhtml + "<td>" + getUnitSelect(index, '', (bill.unit || '')) + "</td>";
            trhtml = trhtml + "<td>" + getCurrencySelect(index, '', (bill.currency || '')) + "</td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].Quantity' onchange='onQuantityChange(event)' value='" + (bill.quantity || '') + "' id='Quantity_" + index + "' /></td>";
            trhtml = trhtml + "<td>" + getRate(index, bill.rate) + "</td>";
            trhtml = trhtml + "<td id='td_Amount_" + index + "' value='" + (bill.amount || '') + "'><label name='InvoiceBillDtos[" + index + "].AmountLabel' id='Amount_" + index + "'>" + amount + "</label></td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].AmountToAgent' id='AmountToAgent_" + index + "' value='" + (bill.amountToAgent || '') + "' /></td>";
            trhtml = trhtml + "<td  style='text-align:center'><input type='checkbox' name='InvoiceBillDtos[" + index + "].IsNonProfit' id='IsNonProfit_" + index + "'" + (bill.isNonProfit ? "checked" : "") + " disabled /></td>";
            trhtml = trhtml + "<td><input type='hidden' name='InvoiceBillDtos[" + index + "].Id' value='" + (bill.id || '') + "'></td>";
            trhtml = trhtml + "<td></td></tr>";
            $("#trtbody").append(trhtml);
            let val = currencyCodeToName[bill.currency || $('#Currency_'+index).val()];
            let conversion = JSON.parse(currencyConvertor);
            let rate = conversion["" + val + "-TWD"];
            if(val == undefined)
            {
                $('#Quantity_'+ index).val(0);
                $('#Rate_'+ index).val(0);
            }
            else{
                getRate(urlParams.get("Mid"), parseFloat(bill.rate).toFixed(2));
            }
            var amount = bill.quantity * $("#Rate_" + index + "").val();
            if(val == undefined || amount == NaN){
                $('#Amount_'+index+'').text(0);
            }else {
                $('#Amount_'+index+'').text(parseFloat(amount).toFixed(2));
            }
            setCurrencyRate($('#Currency_0').val());
            getTotalSubAmount();
            getTotalAmount();
            index++;
            
        }

        function copyItems(id) {
            id = id.replace("new_", "");
            let amount = parseInt($("#Quantity_" + id).val() || 0) * ($("#Rate_" + id).val() || 0);
            var trhtml = "<tr id='_" + index + "'><td style='text-align:center'><input class='checkItem' type='checkbox' name='InvoiceBillDtos[" + index + "].BillId' id='InvoiceBillDtosId_" + index + "' data-val='new_" + index + "'/></td>";
            trhtml = trhtml + "<td>" + getBillCodeSelect(index, '', ($('#Code_0').val() || '')) + "</td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].Description' id='Description_" + index + "' value='" + ($("#Description_" + id).val() || '') + "' /></td>";
            trhtml = trhtml + "<td>" + getPPOrCCSelect(index, '', ($('#PPOrCC_0').val() || '')) + "</td>";
            trhtml = trhtml + "<td>" + getBillTypeSelect(index, '', ($('#BillType_0').val() || '')) + "</td>";
            trhtml = trhtml + "<td>" + getUnitSelect(index, '', ($('#Unit_0').val() || '')) + "</td>";
            trhtml = trhtml + "<td>" + getCurrencySelect(index, '', ($('#Currency_0').val() || '')) + "</td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].Quantity' id='Quantity_" + index + "' value='" + ($("#Quantity_" + id).val() || '') + "' /></td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].Rate' id='Rate_" + index + "' value='" + ($("#Rate_" + id).val() || '') + "' /><input type='hidden' name='InvoiceBillDtos[" + index + "].Amount' id='Amount_" + index + "' value='" + $("#Amount_" + id).val() + "'  /></td>";
            trhtml = trhtml + "<td id='td_Amount_" + index + "'><label name='InvoiceBillDtos[" + index + "].AmountLabel'>" + amount + "</label></td>";
            trhtml = trhtml + "<td><input type='text' name='InvoiceBillDtos[" + index + "].AmountToAgent' id='AmountToAgent_" + index + "' value='" + ($("#AmountToAgent_" + id).val() || '') + "'  /></td>";
            trhtml = trhtml + "<td  style='text-align:center'><input type='checkbox' name='InvoiceBillDtos[" + index + "].IsNonProfit' id='IsNonProfit_" + index + "' disabled /></td>";
            trhtml = trhtml + "<td><input type='hidden' name='InvoiceBillDtos[" + index + "].Id'></td>";
            trhtml = trhtml + "<td></td></tr>";
            $("#trtbody").append(trhtml);
            index++;
        }

        function getBillCodeSelect(id, billCode, value) {
            var selectHtml = "<select name='InvoiceBillDtos[" + index + "].Code' id='Code_" + id + "' style=width:240px;margin-left:-40px>";
            billCode = billCode || value;
            for (var i = 0; i < BillCodeItems.length; i++) {
                var ovalue = BillCodeItems[i].code + ":" + BillCodeItems[i].billingName;
                ovalue = ovalue || value;
                selectHtml = selectHtml + "<option value='" + ovalue + "'";
                if (ovalue == billCode) selectHtml = selectHtml + " selected ";
                selectHtml = selectHtml + " > " + ovalue + "</option>"
            }
            selectHtml = selectHtml + "</select>";
            return selectHtml;
        }
        function getPPOrCCSelect(id, pPOrCC, value) {
            var selectHtml = "<select name='InvoiceBillDtos[" + index + "].PPOrCC' id='PPOrCC_" + id + "'>";
            pPOrCC = pPOrCC || value;
            for (var i = 0; i < PPOrCCItems.length; i++) {
                selectHtml = selectHtml + "<option value='" + PPOrCCItems[i].codeValue + "'";
                if (PPOrCCItems[i].codeValue == pPOrCC) selectHtml = selectHtml + " selected ";
                selectHtml = selectHtml + " > " + PPOrCCItems[i].showName + "</option>"
            }
            selectHtml = selectHtml + "</select>";
            return selectHtml;
        }
        function getBillTypeSelect(id, billType, value) {
            var selectHtml = "<select name='InvoiceBillDtos[" + index + "].BillType' id='BillType_" + id + "'>";
            billType = billType || value;
            for (var i = 0; i < BillTypeItems.length; i++) {
                selectHtml = selectHtml + "<option value='" + BillTypeItems[i].codeValue + "'";
                if (BillTypeItems[i].codeValue == billType) selectHtml = selectHtml + " selected ";
                selectHtml = selectHtml + " > " + BillTypeItems[i].showName + "</option>"
            }
            selectHtml = selectHtml + "</select>";
            return selectHtml;
        }
        function getUnitSelect(id, unit, value) {
            var selectHtml = "<select name='InvoiceBillDtos[" + index + "].Unit' id='Unit_" + id + "'>";
            unit = unit || value;
            for (var i = 0; i < UnitItems.length; i++) {
                selectHtml = selectHtml + "<option value='" + UnitItems[i].codeValue + "'";
                if (UnitItems[i].codeValue == unit) selectHtml = selectHtml + " selected ";
                selectHtml = selectHtml + " > " + UnitItems[i].showName + "</option>"
            }
            selectHtml = selectHtml + "</select>";
            return selectHtml;
        }
        function getCurrencySelect(id, currency, value) {
            var selectHtml = "<select name='InvoiceBillDtos[" + index + "].Currency' onchange='onCurrencyChange(event)' id='Currency_" + id + "'><option value='0'>Select Currency</option>";
            currency = currency || value;
            const set = new Set(CurrencyItems.map(item => JSON.stringify(item)));
            const test = [...set].map(item => JSON.parse(item));
            for (var i = 0; i < test.length; i++) {
                selectHtml = selectHtml + "<option value='" + test[i] + "'";
                if (test[i] == currency) selectHtml = selectHtml + " selected ";
                selectHtml = selectHtml + " > " + test[i] + "</option>"
            }
            selectHtml = selectHtml + "</select>";
            return selectHtml;
        }
        function getRate(id, rate){
            var selectHtml = "<input type='text' name='InvoiceBillDtos[" + id + "].Rate' onchange='onRateChange(event)' value='" + rate + "' id='Rate_" + index + "' readonly/><input type='hidden' name='InvoiceBillDtos[" + id + "].Amount' id='Amount_[" + id + "]' /></td>"
            return selectHtml;
        }
        function goBlank() {
            var mid = '@Model.Mid';
            var bid = '@Model.Bid'
            var mtype = @Model.MethodType;

            var url = "";
            switch (mtype) {
                case 0:
                    url = '/OceanImports/EditModal?Id=' + mid;
                    break;
                case 1:
                    url = '/OceanExports/EditModal?Id=' + mid;
                    break;
                case 2:
                    url = '/AirImports/EditModal3?Id=' + mid;
                    break;
                case 4:
                    url = '/OceanExports/ExportBookings/Edit?Id=' + bid;
                    break;
                default:
                    url = '/OceanExports/EditModal?Id=' + mid;
                    break;
            }
            if (mtype == 4) {
                url = '';
            }
            if (mtype == 1) {
            }
            window.open(url);
        }
        function CopyFromSpecification(){
            var id='@Model.Mid';
            var hid='@Model.Hid';
            if(hid==null||hid=="")
            {
           
           dolphin.freight.importExport.oceanExports.oceanExportMbl.getCreateUpdateOceanExportMblDtoById(id).done(function (result) {
          var data=result;
          $("#Memorandum").val(data.description);
          
           });
            }
            else{
            
               dolphin.freight.importExport.oceanExports.oceanExportHbl.get(hid).done(function (result) {
          var data=result;
          $("#Memorandum").val(data.description);
              
          
           });
            
            
            }
       
        }
    </script>
}
<div class="page-header">
    <abp-breadcrumb>
        <abp-breadcrumb-item title=@L["Menu:Accounting"] />
        @if (Model.InvoiceType == 0 && Model.InvoiceId == null)
        {
            <abp-breadcrumb-item title=@L["Menu:AccountingAR"] />
        }
        @if (Model.InvoiceType == 1)
        {
            <abp-breadcrumb-item title=@L["Menu:AccountingDC"] />
        }
        @if (Model.InvoiceType == 2)
        {
            <abp-breadcrumb-item title=@L["Menu:AccountingAP"] />
        }
        <abp-breadcrumb-item href="@Model.backUrl" title=@L["Menu:BackToMbl"] />

    </abp-breadcrumb>
</div>
<div class="page-content-area">
    <div class="board-wrap">
        <form submit-button="true" data-ajaxForm="true" id="createForm">
            <abp-card border="Dark">
                <abp-card-header style="background:#00CCFF;color:#FFFFFF;">
                    <abp-row class="w-100">
                        <abp-column size-md="_9">
                            <abp-card-title>
                                @if (Model.InvoiceType == 0 && Model.InvoiceId == null)
                                    @L["Title:AccountingAR_Add"]




                                    @if (Model.InvoiceType == 0 && Model.InvoiceId != null)
                                    @L["Title:AccountingAR_Edit"]




                                    @if (Model.InvoiceType == 1 && Model.InvoiceId == null)
                                    @L["Title:AccountingDC_Add"]




                                    @if (Model.InvoiceType == 1 && Model.InvoiceId != null)
                                    @L["Title:AccountingDC_Edit"]




                                    @if (Model.InvoiceType == 2 && Model.InvoiceId == null)
                                    @L["Title:AccountingAP_Add"]




                                    @if (Model.InvoiceType == 2 && Model.InvoiceId != null)
                                    @L["Title:AccountingAP_Edit"]





                                </abp-card-title>

                            </abp-column>
                            <abp-column size-md="_3" class="text-end">

                            </abp-column>

                        </abp-row>
                    </abp-card-header>
                    <abp-card-body class="collapse show customForm" id="mblDiv">
                        <abp-row>
                            <abp-column size-md="_12">
                                <h4>@L["Title:Basic"]</h4>
                            </abp-column>

                        </abp-row>
                        <abp-row>

                            <abp-column size-md="_4">
                                <abp-row>
                                    <abp-column size-md="_7">
                                        <abp-input asp-for="InvoiceMblDto.FilingNo" readonly="true" />
                                    </abp-column>
                                    <abp-column size-md="_3">
                                        <label class="form-label" for=""></label>
                                        <abp-input suppress-label="true" type="text" id="AbbreviationName" asp-for="@Model.InvoiceBasicDto.AbbreviationName" class="form-control" readonly="true" />
                                    </abp-column>
                                    <abp-column size-md="_2">
                                        <label class="form-label" for=""></label>
                                        <abp-button title="" class="btn btn-outline-info" type="button" id="exportBtn" data-busy-text="Processing..." data-bs-toggle="popover" data-bs-trigger="hover" data-bs-placement="top" onclick="goBlank()">
                                            <i class="fa fa-file-export"></i>
                                        </abp-button>
                                    </abp-column>
                                </abp-row>

                            </abp-column>
                            <abp-column size-md="_4">
                                <abp-input asp-for="InvoiceMblDto.MblOverseaAgentName" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_4">
                                <abp-row>
                                    <abp-column size-md="_8">
                                        <label class="form-label" for="Counts">@L["Counts"]</label>
                                        <input type="number" id="Counts" name="Counts" value="" class="form-control " readonly="">
                                    </abp-column>
                                    <abp-column size-md="_4">
                                        <label class="form-label" for=""></label>
                                        <input type="text" id="Ctype" name="Ctype" placeholder="CARTON(S)" class="form-control " readonly="">
                                    </abp-column>
                                </abp-row>
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceMblDto.PorName" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input type="text" id="InvoiceMblDto_PorEtd" asp-for="InvoiceMblDto.PorEtd" class="form-control " readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceMblDto.MblNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="ShipperName">@L["IHblShipperName"]</label>
                                <input type="text" id="ShipperName" name="ShipperName" value="@Model.InvoiceBasicDto.ShipperName" class="form-control " readonly="">
                            </abp-column>

                            <abp-column size-md="_3">
                                <label class="form-label" for="ShipperName">@L["KOS"]/Kg</label>
                                <input type="text" id="Counts" name="KOS" value="" class="form-control " readonly="">
                            </abp-column>                 
                            <abp-column size-md="_3">
                                <label class="form-label" for="ShipperName">@L["KOS"]/Lb</label>
                                    <input type="text" id="Ctype" name="Ctype" value="" class="form-control " readonly="">

                            </abp-column>
                        </abp-row>
                        <abp-row>
                 
                            
                                    <abp-column size-md="_3">
                                        <abp-input asp-for="InvoiceMblDto.PolName" readonly="true" />
                                    </abp-column>
                                    <abp-column size-md="_3">
                                        <label class="form-label" for="InvoiceMblDto_PolEtd"> ETD</label>
                                        <input type="text" id="InvoiceMblDto_PolEtd" name="InvoiceMblDto.PolEtd" value="@Html.DisplayFor(item=>Model.InvoiceMblDto.PolEtd)" class="form-control " readonly="">
                                    </abp-column>
                                
                   
                        </abp-row>

                        <abp-row>
                            <abp-column size-md="_3">
                                <label class="form-label" for="Hblno">@L["IHblno"]</label>
                                <input type="text" id="Hblno" name="Hblno" value="@Model.Hblno" class="form-control " readonly="">
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="ShipperName">@L["MblConsigneeName"]</label>
                                <input type="text" id="ShipperName" name="MblConsigneeName" value="@Model.InvoiceBasicDto.MblConsigneeName" class="form-control " readonly="">
                            </abp-column>
                            <abp-column size-md="_3">

                                <label class="form-label" for="">CBM</label>
                                    <input type="text" id="Cbm" name="Cbm" value="" class="form-control " readonly="">
 
                            </abp-column>
                            <abp-column size-md="_3">
                               
                                    <label class="form-label" for="">CBM</label>
                                    <input type="text" id="Cft" name="Cft" value="" class="form-control " readonly="">
                            
                           
                            </abp-column>
                        </abp-row>
                        <abp-row>

                                    <abp-column size-md="_3">
                                        <abp-input asp-for="InvoiceMblDto.PodName" readonly="true" />
                                    </abp-column>
                                    <abp-column size-md="_3">
                                        <label class="form-label" for="InvoiceMblDto_PolEtd"> ETD</label>
                                        <input type="text" id="InvoiceMblDto_PolEtd" name="InvoiceMblDto.PodEta" value="@Html.DisplayFor(item=>Model.InvoiceMblDto.PodEta)" class="form-control " readonly="">
                                    </abp-column>

                        </abp-row>
                        <abp-row>

                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceMblDto.DelName" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="InvoiceMblDto_PolEtd"> ETA</label>
                                <input type="text" id="InvoiceMblDto_DelEta" name="InvoiceMblDto.PodEta" value="@Html.DisplayFor(item=>Model.InvoiceMblDto.DelEta)" class="form-control " readonly="">
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceMblDto.FdestName" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="InvoiceMblDto_PolEtd"> ETD</label>
                                <input type="text" id="InvoiceMblDto_PolEtd" name="InvoiceMblDto.PodEta" value="@Html.DisplayFor(item=>Model.InvoiceMblDto.FdestEta)" class="form-control " readonly="">
                            </abp-column>
                        </abp-row>

                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceMblDto.SoNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="ShipperName">@L["MblNotifyName"]</label>
                                <input type="text" id="MblNotifyName" name="MblNotifyName" value="@Model.InvoiceBasicDto.MblNotifyName" class="form-control " readonly="">
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="VesselNameVoyage"> @L["VesselNameVoyage"]</label>
                                <input type="text" id="VesselNameVoyage" name="VesselNameVoyage" value="@Model.InvoiceBasicDto.VesselNameVoyage" class="form-control " readonly="">
                            </abp-column>
                            <abp-column size-md="_3">
                                <label class="form-label" for="VesselNameVoyage"> @L["MblOperatorId"]</label>
                                <input type="text" id="MblOperatorId" name="MblOperatorId" value="@Model.InvoiceBasicDto.MblOperatorName" class="form-control " readonly="">
                            </abp-column>

                        </abp-row>

                        <abp-row>
                            <abp-column>
                                <hr />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_12">
                                <h4>@L["Title:Invoice"]</h4>
                                <abp-input type="hidden" asp-for="InvoiceDto.InvoiceStatus" id="InvoiceDto_InvoiceStatus" value="0" />
                                <abp-input type="hidden" asp-for="InvoiceDto.InvoiceType" id="InvoiceDto_InvoiceType" value="@Model.InvoiceType" />
                                <abp-input type="hidden" asp-for="InvoiceDto.Id" />
                            </abp-column>
                        </abp-row>

                        @if (Model.InvoiceType == 0)
                    {
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input type="text" asp-for="InvoiceDto.InvoiceNo" id="InvoiceNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.ShipToId" asp-items="@Model.TradePartnerLookupList" />
                                <abp-input type="hidden" name="ShipToId" id="mShipToId" asp-for="@Model.InvoiceDto.ShipToId" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.OutstandingAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastDate" id="LastDate" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.InvoiceCompanyId" asp-items="@Model.TradePartnerLookupList" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PostDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PaidAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.IncotermsId" asp-items="@Model.SysCodeLookupList" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.AttentionTo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceDate" />
                            </abp-column>
                            <abp-column size-md="_6">
                                <abp-input asp-for="InvoiceDto.PoNo" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.DueDate" type="text" abp-data-datepicker="false" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_6">
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_6">
                                <label for="Memorandum" class="form-label">@L["Memorandum"]</label>
                                <abp-button class="btn btn-info me-md-2" style="color:#FFFFFF;" type="button" onclick="CopyFromSpecification()">@L["Btn:CopyFromSpecification"]</abp-button>
                                <textarea asp-for="InvoiceDto.Memorandum" name="InvoiceDto.Memorandum" id="Memorandum" class="form-control"></textarea>
                            </abp-column>
                            <abp-column size-md="_3" class="expandCheck">
                                <label for="InvoiceDto_IsAmountConfirmed" class="form-label">@L["IsAmountConfirmed"]<input type="checkbox" name="InvoiceDto.IsAmountConfirmed" id="InvoiceDto_IsAmountConfirmed" value="true" checked="@Model.InvoiceDto.IsAmountConfirmed" /></label>
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.CcyRateSourceId" asp-items="@Model.SysCodeLookupList" style="width:230px" />
                            </abp-column>
                        </abp-row>
                    }
                    @if (Model.InvoiceType == 1)
                    {
                        <abp-row>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:DCNo"]
                            </label>
                            <input type="text" name="InvoiceDto.InvoiceNo" id="InvoiceNo" value="@Model.InvoiceDto.InvoiceNo" />*@
                                <abp-input asp-for="InvoiceDto.InvoiceNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PostDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.OutstandingAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastNo" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:InvoiceCompanyIdDC"]
                            </label>*@
                                <abp-select asp-for="InvoiceDto.InvoiceCompanyId" asp-items="@Model.TradePartnerLookupList" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PaidAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:LastDate"]
                            </label>
                            <input type="text" name="InvoiceDto.LastDate" id="LastDate" value="@Model.InvoiceDto.InvoiceNo" readonly />*@
                                <abp-input asp-for="InvoiceDto.LastDate" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.CustomerRefNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.DueDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.ProfitShare" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @await Component.InvokeAsync(typeof(DropdownComponent),new ComponentData { Name = "InvoiceDto.IncotermsId", AspItems = @Model.SysCodeLookupList, IsShowLabel = true, FieldName = "IncotermsId" })
                                @*<abp-select asp-for="InvoiceDto.IncotermsId" asp-items="@Model.SysCodeLookupList" />*@
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_6">
                                <label for="Memorandum" class="form-label">@L["Memorandum"]</label>
                                <abp-button class="btn btn-info me-md-2" style="color:#FFFFFF;" type="button" onclick="Btn:CopyFromSpecification()">@L["Btn:CopyFromSpecification"]</abp-button>
                                <textarea asp-for="InvoiceDto.Memorandum" name="InvoiceDto.Memorandum" id="Memorandum" class="form-control"></textarea>
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.IsAmountConfirmed" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @*@await Component.InvokeAsync(typeof(SelectComponent),new {TagName =  "CcyRateSourceId", FieldName = "CcyRateSourceId",DefaultValue="" , IsShowLabel = true , IsRequired = false })*@
                                <abp-select asp-for="InvoiceDto.CcyRateSourceId" asp-items="@Model.SysCodeLookupList" style="width:230px" />
                            </abp-column>
                        </abp-row>
                    }
                    @if (Model.InvoiceType == 2)
                    {
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.ShipToId" asp-items="@Model.TradePartnerLookupList" />
                                <abp-input type="hidden" asp-for="InvoiceDto.InvoiceCompanyId" id="mInvoiceCompanyId" value="@Model.InvoiceDto.InvoiceCompanyId" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PostDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.OutstandingAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastNo" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PaidAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastDate" abp-data-datepicker="false" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.SystemNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.DueDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.IncotermsId" asp-items="@Model.SysCodeLookupList" />
                            </abp-column>
                            @*<abp-column size-md="_6">

                        </abp-column>*@
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_6">
                                <label for="Memorandum" class="form-label">@L["Memorandum"]</label>
                                <abp-button class="btn btn-info me-md-2" style="color:#FFFFFF;" type="button" onclick="Btn:CopyFromSpecification()">@L["Btn:CopyFromSpecification"]</abp-button>
                                <textarea asp-for="InvoiceDto.Memorandum" name="InvoiceDto.Memorandum" id="Memorandum" class="form-control"></textarea>
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.IsAmountConfirmed" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.CcyRateSourceId" asp-items="@Model.SysCodeLookupList" style="width:230px" />
                            </abp-column>
                        </abp-row>
                    }

                    @if (Model.InvoiceType == 3)
                    {
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.ShipToId" asp-items="@Model.TradePartnerLookupList" />
                                <abp-input type="hidden" asp-for="InvoiceDto.InvoiceCompanyId" id="mInvoiceCompanyId" value="@Model.InvoiceDto.InvoiceCompanyId" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PostDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.OutstandingAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastNo" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PaidAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastDate" abp-data-datepicker="false" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.SystemNo" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.DueDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.IncotermsId" asp-items="@Model.SysCodeLookupList" />
                            </abp-column>
                            @*<abp-column size-md="_6">

                        </abp-column>*@
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_6">
                                <label for="Memorandum" class="form-label">@L["Memorandum"]</label>
                                <abp-button class="btn btn-info me-md-2" style="color:#FFFFFF;" type="button" onclick="Btn:CopyFromSpecification()">@L["Btn:CopyFromSpecification"]</abp-button>
                                <textarea asp-for="InvoiceDto.Memorandum" name="InvoiceDto.Memorandum" id="Memorandum" class="form-control"></textarea>
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.IsAmountConfirmed" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-select asp-for="InvoiceDto.CcyRateSourceId" asp-items="@Model.SysCodeLookupList" style="width:230px" />
                            </abp-column>
                        </abp-row>
                    }
                    @if (Model.InvoiceType == 4)
                    {
                        <abp-row>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:DCNo"]
                            </label>
                            <input type="text" name="InvoiceDto.InvoiceNo" id="InvoiceNo" value="@Model.InvoiceDto.InvoiceNo" />*@
                                <abp-input asp-for="InvoiceDto.InvoiceNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PostDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.OutstandingAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.LastNo" readonly="true" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:InvoiceCompanyIdDC"]
                            </label>*@
                                <abp-select asp-for="InvoiceDto.InvoiceCompanyId" asp-items="@Model.TradePartnerLookupList" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.InvoiceDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.PaidAmount" readonly="true" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @*<label for="InvoiceNo" class="form-label">
                            @L["Display:LastDate"]
                            </label>
                            <input type="text" name="InvoiceDto.LastDate" id="LastDate" value="@Model.InvoiceDto.InvoiceNo" readonly />*@
                                <abp-input asp-for="InvoiceDto.LastDate" />
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.CustomerRefNo" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.DueDate" />
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.ProfitShare" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @await Component.InvokeAsync(typeof(DropdownComponent),new ComponentData { Name = "InvoiceDto.IncotermsId", AspItems = @Model.SysCodeLookupList, IsShowLabel = true, FieldName = "IncotermsId" })
                                @*<abp-select asp-for="InvoiceDto.IncotermsId" asp-items="@Model.SysCodeLookupList" />*@
                            </abp-column>
                        </abp-row>
                        <abp-row>
                            <abp-column size-md="_6">
                                <label for="Memorandum" class="form-label">@L["Memorandum"]</label>
                                <abp-button class="btn btn-info me-md-2" style="color:#FFFFFF;" type="button" onclick="Btn:CopyFromSpecification()">@L["Btn:CopyFromSpecification"]</abp-button>
                                <textarea asp-for="InvoiceDto.Memorandum" name="InvoiceDto.Memorandum" id="Memorandum" class="form-control"></textarea>
                            </abp-column>
                            <abp-column size-md="_3">
                                <abp-input asp-for="InvoiceDto.IsAmountConfirmed" />
                            </abp-column>
                            <abp-column size-md="_3">
                                @*@await Component.InvokeAsync(typeof(SelectComponent),new {TagName =  "CcyRateSourceId", FieldName = "CcyRateSourceId",DefaultValue="" , IsShowLabel = true , IsRequired = false })*@
                                <abp-select asp-for="InvoiceDto.CcyRateSourceId" asp-items="@Model.SysCodeLookupList" style="width:230px" />
                            </abp-column>
                        </abp-row>
                    }
                    <abp-row><abp-column>&nbsp;</abp-column></abp-row>
                    <abp-row>
                        <abp-column>
                            <abp-button class="btn btn-success me-md-2" type="button" id="addBtn">+</abp-button>
                            <abp-button class="btn btn-outline-success me-md-2" type="button" id="add5Btn">+5</abp-button>
                            <abp-button class="btn btn-outline-warning me-md-2" type="button" id="copyBtn">@L["Btn:Copy"]</abp-button>
                            <abp-button class="btn btn-outline-danger me-md-2" type="button" id="deleteBtn">@L["Btn:Delete"]</abp-button>
                        </abp-column>
                    </abp-row>
                    <abp-row>
                        <abp-column style="overflow-x:scroll">
                            <abp-table class="nowrap" border="1" id="table" style="width:2600px;border-block-color:#333333;padding-left:10px;margin:4px;  table-layout: fixed; ">
                                <tr style="border:1;border-block-color:#333333;padding-left:10px;margin-left:4px;">
                                    <th width="6%" style="text-align:center"><input type="checkbox" id="checkAll" /></th>
                                    <th width="8%">@L["Display:BillCode"]</th>
                                    <th width="8%">@L["Display:BillDescription"]</th>
                                    <th width="8%">@L["Display:PPOrCC"]</th>
                                    <th width="8%">@L["Display:BillType"]</th>
                                    <th width="8%">@L["Display:BillUnit"]</th>
                                    <th width="8%">@L["Display:BillCurrency"]</th>
                                    <th width="8%">@L["Display:BillQuantity"]</th>
                                    <th width="8%">@L["Display:BillRate"]</th>
                                    <th width="8%">@L["Display:BillAmount"]</th>
                                    <th width="8%">@L["Display:AmountToAgent"]</th>
                                    <th width="6%" style="text-align:center">N</th>
                                    <th width="8%">@L["Display:BillStatus"]</th>
                                </tr>
                                <tbody id="trtbody">
                                </tbody>
                                <tfoot>
                                    <tr border="1">
                                        <th colspan="5" style="text-align:right;border-block-color:#333333;" border="1">小計</th>
                                        <th>TWD</th>
                                        <th id="convertedTWD">0</th>
                                        <th>USD</th>
                                        <th id="convertedUSD">0</th>
                                        <th>RMB</th>
                                        <th id="convertedRMB">0</th>
                                        <th>HKD</th>
                                        <th id="convertedHKD">0</th>
                                    </tr>
                                    <tr border="1">
                                        <th colspan="12" style="text-align:right;border-block-color:#333333;" border="1">總計</th>
                                        <th id="totalAmount">0</th>
                                        @*<th id="totalAmount">0 <input type="hidden" name="" /></th>*@
                                    </tr>
                                </tfoot>
                            </abp-table>
                        </abp-column>
                    </abp-row>
                </abp-card-body>
            </abp-card>
            <abp-row>
                <abp-column>
                    <abp-button class="btn btn-primary me-md-2" type="button" id="saveDraftBtn">@L["Btn:SaveDraft"].Value</abp-button>
                    <abp-button class="btn btn-primary me-md-2" type="button" id="saveBtn">@L["Btn:Save"].Value</abp-button>
                    <abp-button class="btn btn-primary me-md-2" type="button" id="saveNewBtn">@L["Btn:SaveNew"].Value</abp-button>
                </abp-column>
            </abp-row>
        </form>
    </div>
</div>
